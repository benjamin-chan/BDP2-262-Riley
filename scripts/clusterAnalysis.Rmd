# Cluster analysis

Use divisive hierarchical clustering (DIANA).
See [Divisive Hierarchical Clustering Essentials](http://www.sthda.com/english/articles/28-hierarchical-clustering-essentials/94-divisive-hierarchical-clustering-essentials/).

```{r}
library(cluster)
library(factoextra)
citation("factoextra")
```

```{r}
metric <- "manhattan"
plotClusters <- function (df, title = "Cluster plot") {
  require(magrittr)
  require(ggplot2)
  require(factoextra)
  require(viridis)
  df %>% 
  fviz_cluster(data = mat, 
               palette = viridis(k, alpha = 1/16), 
               geom = c("points"),
               labelsize = 8, 
               ellipse.type = "convex",
               star.plot = TRUE) + 
  ggtitle(title) +
  theme(panel.grid.minor = element_blank())
}
hcDIANA <- function(k) {
  require(magrittr)
  require(ggplot2)
  require(factoextra)
  require(viridis)
  hcut <-
    dist %>% 
    hcut(k = k, hc_func = "diana", hc_metric = metric)
  tab <- hcut$cluster %>% table()
  dend <- 
    hcut %>% 
    fviz_dend(k = k, 
              type = "circular",
              rect = TRUE, 
              rect_fill = TRUE,
              cex = 0.2, 
              k_colors = viridis(k), 
              main = sprintf("DIANA\nk = %d", k))
  clust <- hcut %>% plotClusters(sprintf("DIANA\nDivisive coefficient = %.03f\nk = %d", diana$dc, k))
  silh <- 
    hcut %>% 
    fviz_silhouette(palette = viridis(k), ggtheme = theme_minimal()) + 
    theme(panel.grid.major.x = element_blank()) +
    ggtitle(sprintf("DIANA\nk = %d\nAverage silhouette width = %.03f\nCluster average silhouette widths = %s",
                    k,
                    hcut[["silinfo"]][["avg.width"]],
                    hcut[["silinfo"]][["clus.avg.widths"]] %>% round(3) %>% paste(collapse = ", ")))
  list(hcut = hcut,
       table = tab,
       dendrogram = dend,
       clusters2d = clust,
       silhouette = silh)
}
```

Use the **`r metric`** metric.

```{r}
# load("data/processed/dataframes.RData")
dfNonMissing <- 
  df %>% 
  na.omit()
dfXMetrics <- 
  dfNonMissing %>% 
  select(matches("ECBI|MAPS|SEPTI")) %>% 
  droplevels()
dfXECBI <- 
  dfNonMissing %>% 
  select(starts_with("ECBI")) %>% 
  droplevels()
dfXMAPS <- 
  dfNonMissing %>% 
  select(starts_with("MAPS")) %>% 
  droplevels()
dfXSEPTI <- 
  dfNonMissing %>% 
  select(starts_with("SEPTI")) %>% 
  droplevels()
dfXParentChild <- 
  dfNonMissing %>% 
  select(matches("parent|child|birth", ignore.case = TRUE)) %>% 
  droplevels()
dfXParent <- 
  dfNonMissing %>% 
  select(matches("^parent|^total", ignore.case = TRUE)) %>% 
  droplevels()
dfXChild <- 
  dfNonMissing %>% 
  select(matches("^child|^birth", ignore.case = TRUE)) %>% 
  droplevels()
dfXDemog <- 
  dfNonMissing %>% 
  select(matches("lang|zip|community|distance|income|internet")) %>% 
  select(-languageSurvey) %>% 
  droplevels()
dfXMetricsDemog <- 
  dfNonMissing %>% 
  select(matches("ECBI|MAPS|SEPTI|income|parentEduc|parentRaceW")) %>% 
  droplevels()
dfYPCB <- 
  dfNonMissing %>% 
  select(starts_with("PCB"))
dfXY <- 
  bind_cols(dfXMetricsDemog, dfYPCB) %>%
  select(-income) %>%
  select(-parentEducation)
```


## Cluster on PCB metrics

**Clustering on PCB metrics isn't terrible.**

```{r}
mat <- model.matrix(~ - 1 + ., data = dfYPCB) %>% scale()
dist <- mat %>% dist(method = metric)
dim(mat)
colnames(mat)
hopkins <- get_clust_tendency(mat, n = nrow(mat) - 1, graph = FALSE)
diana <- dist %>% diana(metric = metric)
k <- 2
dianaYPCB <- hcDIANA(k)
```

* Hopkins statistic is `r sprintf("%.03f", hopkins$hopkins_stat)`
* Analysis identified $k = `r k`$ clusters
* Divisive coefficient is `r sprintf("%.03f", diana$dc)`
* Average silhouette width is `r sprintf("%.03f", dianaYPCB[["hcut"]][["silinfo"]][["avg.width"]])`

```{r clusterYPCB}
dianaYPCB[["dendrogram"]]
dianaYPCB[["clusters2d"]]
dianaYPCB[["silhouette"]]
```

```{r}
bind_cols(dfYPCB, 
          data.frame(cluster = dianaYPCB[["hcut"]][["cluster"]] %>% factor())) %>%
  group_by(cluster) %>%
  summarize(n = n(),
            PCB1_Total_mean      = mean(PCB1_Total),
            PCB1_CondEmot_mean   = mean(PCB1_CondEmot),
            PCB1_DevHab_mean     = mean(PCB1_DevHab)) %>% 
  kable(digits = 1)
bind_cols(dfYPCB, 
          data.frame(cluster = dianaYPCB[["hcut"]][["cluster"]] %>% factor())) %>%
  group_by(cluster) %>%
  summarize(n = n(),
            PCB2_Tot_mean        = mean(PCB2_Tot)) %>% 
  kable(digits = 1)
bind_cols(dfYPCB, 
          data.frame(cluster = dianaYPCB[["hcut"]][["cluster"]] %>% factor())) %>%
  group_by(cluster) %>%
  summarize(n = n(),
            PCB3_Total_mean      = mean(PCB3_Total),
            PCB3_PCPonly_mean    = mean(PCB3_PCPonly),
            PCB3_Person_mean     = mean(PCB3_Person),
            PCB3_Resource_mean   = mean(PCB3_Resource)) %>% 
  kable(digits = 1)
```

* Cluster 1 ($`r sprintf("n = %d", dianaYPCB[["hcut"]][["size"]][1])`$) has high PCB scores on all domains
* Cluster 2 ($`r sprintf("n = %d", dianaYPCB[["hcut"]][["size"]][2])`$) has low PCB scores on all domains


## Cluster on ECBI metrics

```{r}
mat <- model.matrix(~ - 1 + ., data = dfXECBI) %>% scale()
dist <- mat %>% dist(method = metric)
dim(mat)
colnames(mat)
hopkins <- get_clust_tendency(mat, n = nrow(mat) - 1, graph = FALSE)
diana <- dist %>% diana(metric = metric)
k <- 2
dianaXECBI <- hcDIANA(k)
```

* Hopkins statistic is `r sprintf("%.03f", hopkins$hopkins_stat)`
* Analysis identified $k = `r k`$ clusters
* Divisive coefficient is `r sprintf("%.03f", diana$dc)`
* Average silhouette width is `r sprintf("%.03f", dianaXECBI[["hcut"]][["silinfo"]][["avg.width"]])`

```{r clusterXECBI}
dianaXECBI[["dendrogram"]]
dianaXECBI[["clusters2d"]]
dianaXECBI[["silhouette"]]
```

```{r}
bind_cols(dfXECBI, 
          data.frame(cluster = dianaXECBI[["hcut"]][["cluster"]] %>% factor())) %>%
  group_by(cluster) %>%
  summarize(n = n(),
            ECBI_intensity_T_score_mean = mean(ECBI_intensity_T_score),
            ECBI_problem_T_score_mean   = mean(ECBI_problem_T_score),
            ECBI_Opp_mean               = mean(ECBI_Opp),
            ECBI_Inatt_mean             = mean(ECBI_Inatt),
            ECBI_Cond_mean              = mean(ECBI_Cond)) %>%
  kable(digits = 1)
```

**Clustering on ECBI alone is good**

* Cluster 1 ($`r sprintf("n = %d", dianaXECBI[["hcut"]][["size"]][1])`$) has low ECBI scores
* Cluster 2 ($`r sprintf("n = %d", dianaXECBI[["hcut"]][["size"]][2])`$) has high ECBI scores


## Cluster on MAPS metrics

```{r}
mat <- model.matrix(~ - 1 + ., data = dfXMAPS) %>% scale()
dist <- mat %>% dist(method = metric)
dim(mat)
colnames(mat)
hopkins <- get_clust_tendency(mat, n = nrow(mat) - 1, graph = FALSE)
diana <- dist %>% diana(metric = metric)
k <- 3
dianaXMAPS <- hcDIANA(k)
```

* Hopkins statistic is `r sprintf("%.03f", hopkins$hopkins_stat)`
* Analysis identified $k = `r k`$ clusters
* Divisive coefficient is `r sprintf("%.03f", diana$dc)`
* Average silhouette width is `r sprintf("%.03f", dianaXMAPS[["hcut"]][["silinfo"]][["avg.width"]])`

```{r clusterXMAPS}
dianaXMAPS[["dendrogram"]]
dianaXMAPS[["clusters2d"]]
dianaXMAPS[["silhouette"]]
```

```{r}
bind_cols(dfXMAPS, 
          data.frame(cluster = dianaXMAPS[["hcut"]][["cluster"]] %>% factor())) %>%
  group_by(cluster) %>%
  summarize(n = n(),
            MAPS_PP_mean  = mean(MAPS_PP),
            MAPS_PR_mean  = mean(MAPS_PR),
            MAPS_WM_mean  = mean(MAPS_WM),
            MAPS_SP_mean  = mean(MAPS_SP),
            MAPS_HS_mean  = mean(MAPS_HS),
            MAPS_LC_mean  = mean(MAPS_LC),
            MAPS_PC_mean  = mean(MAPS_PC),
            MAPS_POS_mean = mean(MAPS_POS),
            MAPS_NEG_mean = mean(MAPS_NEG)) %>%
  kable(digits = 1)
```

**Clustering on MAPS alone is good**

* Cluster 1 ($`r sprintf("n = %d", dianaXMAPS[["hcut"]][["size"]][1])`$) has high *positive* MAPS scores
* Cluster 2 ($`r sprintf("n = %d", dianaXMAPS[["hcut"]][["size"]][2])`$) has high *negative* MAPS scores
* Cluster 3 ($`r sprintf("n = %d", dianaXMAPS[["hcut"]][["size"]][3])`$) is an outlier with low positive and low negative MAPS scores


## Cluster on SEPTI metrics

```{r}
mat <- model.matrix(~ - 1 + ., data = dfXSEPTI) %>% scale()
dist <- mat %>% dist(method = metric)
dim(mat)
colnames(mat)
hopkins <- get_clust_tendency(mat, n = nrow(mat) - 1, graph = FALSE)
diana <- dist %>% diana(metric = metric)
k <- 2
dianaXSEPTI <- hcDIANA(k)
```

* Hopkins statistic is `r sprintf("%.03f", hopkins$hopkins_stat)`
* Analysis identified $k = `r k`$ clusters
* Divisive coefficient is `r sprintf("%.03f", diana$dc)`
* Average silhouette width is `r sprintf("%.03f", dianaXSEPTI[["hcut"]][["silinfo"]][["avg.width"]])`

```{r clusterXSEPTI}
dianaXSEPTI[["dendrogram"]]
dianaXSEPTI[["clusters2d"]]
dianaXSEPTI[["silhouette"]]
```

```{r}
bind_cols(dfXSEPTI, 
          data.frame(cluster = dianaXSEPTI[["hcut"]][["cluster"]] %>% factor())) %>%
  group_by(cluster) %>%
  summarize(n = n(),
            SEPTI_nurturance_mean = mean(SEPTI_nurturance),
            SEPTI_discipline_mean = mean(SEPTI_discipline),
            SEPTI_play_mean       = mean(SEPTI_play),
            SEPTI_routine_mean    = mean(SEPTI_routine)) %>%
  kable(digits = 1)
```

**Clustering on ECBI, MAPS, and SEPTI metrics isn't terrible.**

* Cluster 1 ($`r sprintf("n = %d", dianaXSEPTI[["hcut"]][["size"]][1])`$) has high SEPTI scores
* Cluster 2 ($`r sprintf("n = %d", dianaXSEPTI[["hcut"]][["size"]][2])`$) has low SEPTI scores


## Cluster on ECBI, MAPS, SEPTI metrics and demographics

```{r}
mat <- model.matrix(~ - 1 + ., data = dfXMetricsDemog) %>% scale()
dist <- mat %>% dist(method = metric)
dim(mat)
colnames(mat)
hopkins <- get_clust_tendency(mat, n = nrow(mat) - 1, graph = FALSE)
diana <- dist %>% diana(metric = metric)
k <- 3
dianaXMetricsDemog <- hcDIANA(k)
```

* Hopkins statistic is `r sprintf("%.03f", hopkins$hopkins_stat)`
* Analysis identified $k = `r k`$ clusters
* Divisive coefficient is `r sprintf("%.03f", diana$dc)`
* Average silhouette width is `r sprintf("%.03f", dianaXMetricsDemog[["hcut"]][["silinfo"]][["avg.width"]])`

```{r clusterXMetricsDemog}
dianaXMetricsDemog[["dendrogram"]]
dianaXMetricsDemog[["clusters2d"]]
dianaXMetricsDemog[["silhouette"]]
```

```{r}
bind_cols(dfXMetricsDemog, 
          data.frame(cluster = dianaXMetricsDemog[["hcut"]][["cluster"]] %>% factor())) %>%
  group_by(cluster) %>%
  summarize(n = n(),
            ECBI_intensity_T_score_mean = mean(ECBI_intensity_T_score),
            ECBI_problem_T_score_mean   = mean(ECBI_problem_T_score),
            ECBI_Opp_mean               = mean(ECBI_Opp),
            ECBI_Inatt_mean             = mean(ECBI_Inatt),
            ECBI_Cond_mean              = mean(ECBI_Cond)) %>%
  kable(digits = 1)
bind_cols(dfXMetricsDemog, 
          data.frame(cluster = dianaXMetricsDemog[["hcut"]][["cluster"]] %>% factor())) %>%
  group_by(cluster) %>%
  summarize(n = n(),
            MAPS_PP_mean  = mean(MAPS_PP),
            MAPS_PR_mean  = mean(MAPS_PR),
            MAPS_WM_mean  = mean(MAPS_WM),
            MAPS_SP_mean  = mean(MAPS_SP),
            MAPS_HS_mean  = mean(MAPS_HS),
            MAPS_LC_mean  = mean(MAPS_LC),
            MAPS_PC_mean  = mean(MAPS_PC),
            MAPS_POS_mean = mean(MAPS_POS),
            MAPS_NEG_mean = mean(MAPS_NEG)) %>%
  kable(digits = 1)
bind_cols(dfXMetricsDemog, 
          data.frame(cluster = dianaXMetricsDemog[["hcut"]][["cluster"]] %>% factor())) %>%
  group_by(cluster) %>%
  summarize(n = n(),
            SEPTI_nurturance_mean = mean(SEPTI_nurturance),
            SEPTI_discipline_mean = mean(SEPTI_discipline),
            SEPTI_play_mean       = mean(SEPTI_play),
            SEPTI_routine_mean    = mean(SEPTI_routine)) %>%
  kable(digits = 1)
```

```{r}
bind_cols(dfXMetricsDemog, 
          data.frame(cluster = dianaXMetricsDemog[["hcut"]][["cluster"]] %>% factor())) %>%
  group_by(cluster, income) %>%
  summarize(n = n()) %>% 
  mutate(pct = n / sum(n)) %>% 
  kable(digits = 2)
bind_cols(dfXMetricsDemog, 
          data.frame(cluster = dianaXMetricsDemog[["hcut"]][["cluster"]] %>% factor())) %>%
  group_by(cluster, parentEducation) %>%
  summarize(n = n()) %>% 
  mutate(pct = n / sum(n)) %>% 
  kable(digits = 2)
bind_cols(dfXMetricsDemog, 
          data.frame(cluster = dianaXMetricsDemog[["hcut"]][["cluster"]] %>% factor())) %>%
  group_by(cluster, parentRaceWhite) %>%
  summarize(n = n()) %>% 
  mutate(pct = n / sum(n)) %>% 
  kable(digits = 2)
```

**Clustering on ECBI, MAPS, and SEPTI metrics and a limited set of demographic factors is good.**

* Demographic factors considered
  * Income
  * Parent education level
  * Parent race, White/Non-White
* Cluster 1 ($`r sprintf("n = %d", dianaXMetricsDemog[["hcut"]][["size"]][1])`$)
  * Majority White
  * Lower ECBI scores than Cluster 2
  * Higher positive MAPS scores than Cluster 2, lower negative MAPS scores than Cluster 2
  * Higher SEPTI scores than Cluster 2
* Cluster 2 ($`r sprintf("n = %d", dianaXMetricsDemog[["hcut"]][["size"]][2])`$)
  * Majority non-White
  * High ECBI scores
  * Low positive MAPS scores, high negative MAPS scores
  * Low SEPTI scores
* Cluster 3 ($`r sprintf("n = %d", dianaXMetricsDemog[["hcut"]][["size"]][3])`$)
  * Is a small outlier cluster
  * Middle income
  * Low ECBI scores
  * Low positive MAPS scores, low negative MAPS scores
* Removing income and parent education level produces better defined clusters
  * **See further analysis below**

```{r}
dfXMetricsDemog2 <- 
  dfXMetricsDemog %>%
  select(-income) %>%
  select(-parentEducation)
mat <- model.matrix(~ - 1 + ., data = dfXMetricsDemog2) %>% scale()
dist <- mat %>% dist(method = metric)
dim(mat)
colnames(mat)
hopkins <- get_clust_tendency(mat, n = nrow(mat) - 1, graph = FALSE)
diana <- dist %>% diana(metric = metric)
k <- 4
dianaXMetricsDemog <- hcDIANA(k)
```

* Hopkins statistic is `r sprintf("%.03f", hopkins$hopkins_stat)`
* Analysis identified $k = `r k`$ clusters
* Divisive coefficient is `r sprintf("%.03f", diana$dc)`
* Average silhouette width is `r sprintf("%.03f", dianaXMetricsDemog[["hcut"]][["silinfo"]][["avg.width"]])`

```{r clusterXMetricsDemog2}
dianaXMetricsDemog[["dendrogram"]]
dianaXMetricsDemog[["clusters2d"]]
dianaXMetricsDemog[["silhouette"]]
```

```{r}
bind_cols(dfXMetricsDemog2, 
          data.frame(cluster = dianaXMetricsDemog[["hcut"]][["cluster"]] %>% factor())) %>%
  group_by(cluster) %>%
  summarize(n = n(),
            ECBI_intensity_T_score_mean = mean(ECBI_intensity_T_score),
            ECBI_problem_T_score_mean   = mean(ECBI_problem_T_score),
            ECBI_Opp_mean               = mean(ECBI_Opp),
            ECBI_Inatt_mean             = mean(ECBI_Inatt),
            ECBI_Cond_mean              = mean(ECBI_Cond)) %>%
  kable(digits = 1)
bind_cols(dfXMetricsDemog2, 
          data.frame(cluster = dianaXMetricsDemog[["hcut"]][["cluster"]] %>% factor())) %>%
  group_by(cluster) %>%
  summarize(n = n(),
            MAPS_PP_mean  = mean(MAPS_PP),
            MAPS_PR_mean  = mean(MAPS_PR),
            MAPS_WM_mean  = mean(MAPS_WM),
            MAPS_SP_mean  = mean(MAPS_SP),
            MAPS_HS_mean  = mean(MAPS_HS),
            MAPS_LC_mean  = mean(MAPS_LC),
            MAPS_PC_mean  = mean(MAPS_PC),
            MAPS_POS_mean = mean(MAPS_POS),
            MAPS_NEG_mean = mean(MAPS_NEG)) %>%
  kable(digits = 1)
bind_cols(dfXMetricsDemog2, 
          data.frame(cluster = dianaXMetricsDemog[["hcut"]][["cluster"]] %>% factor())) %>%
  group_by(cluster) %>%
  summarize(n = n(),
            SEPTI_nurturance_mean = mean(SEPTI_nurturance),
            SEPTI_discipline_mean = mean(SEPTI_discipline),
            SEPTI_play_mean       = mean(SEPTI_play),
            SEPTI_routine_mean    = mean(SEPTI_routine)) %>%
  kable(digits = 1)
```

```{r}
bind_cols(dfXMetricsDemog2, 
          data.frame(cluster = dianaXMetricsDemog[["hcut"]][["cluster"]] %>% factor())) %>%
  group_by(cluster, parentRaceWhite) %>%
  summarize(n = n()) %>% 
  mutate(pct = n / sum(n)) %>% 
  kable(digits = 2)
```

```{r}
bind_cols(dfYPCB, 
          data.frame(cluster = dianaXMetricsDemog[["hcut"]][["cluster"]] %>% factor())) %>%
  group_by(cluster) %>%
  summarize(n = n(),
            PCB1_Total_mean      = mean(PCB1_Total),
            PCB1_CondEmot_mean   = mean(PCB1_CondEmot),
            PCB1_DevHab_mean     = mean(PCB1_DevHab)) %>% 
  kable(digits = 1)
bind_cols(dfYPCB, 
          data.frame(cluster = dianaXMetricsDemog[["hcut"]][["cluster"]] %>% factor())) %>%
  group_by(cluster) %>%
  summarize(n = n(),
            PCB2_Tot_mean        = mean(PCB2_Tot)) %>% 
  kable(digits = 1)
bind_cols(dfYPCB, 
          data.frame(cluster = dianaXMetricsDemog[["hcut"]][["cluster"]] %>% factor())) %>%
  group_by(cluster) %>%
  summarize(n = n(),
            PCB3_Total_mean      = mean(PCB3_Total),
            PCB3_PCPonly_mean    = mean(PCB3_PCPonly),
            PCB3_Person_mean     = mean(PCB3_Person),
            PCB3_Resource_mean   = mean(PCB3_Resource)) %>% 
  kable(digits = 1)
```

* Demographic factors considered
  * Parent race, White/Non-White
* Cluster 1 ($`r sprintf("n = %d", dianaXMetricsDemog[["hcut"]][["size"]][1])`$)
  * Majority White
  * Lower ECBI scores than Clusters 2/4
  * Higher positive MAPS scores than Clusters 2/4, lower negative MAPS scores than Clusters 2/4
  * Higher SEPTI scores than Clusters 2/4
* Cluster 2 ($`r sprintf("n = %d", dianaXMetricsDemog[["hcut"]][["size"]][2])`$)
  * Majority White, *more similar to Cluster 1*
  * High ECBI scores, *more similar to Cluster 4*
  * Low positive MAPS scores, high negative MAPS scores, *more similar to Cluster 4*
  * Low SEPTI scores, *more similar to Cluster 4*
* Cluster 3 ($`r sprintf("n = %d", dianaXMetricsDemog[["hcut"]][["size"]][3])`$)
  * Is a small outlier cluster
  * Middle income
  * Low ECBI scores
  * Low positive MAPS scores, low negative MAPS scores
* Cluster 4 ($`r sprintf("n = %d", dianaXMetricsDemog[["hcut"]][["size"]][2])`$)
  * Majority non-White
  * High ECBI scores
  * Low positive MAPS scores, high negative MAPS scores
  * Low SEPTI scores


## Cluster on PCB, ECBI, MAPS, SEPTI metrics and demographics

```{r}
mat <- model.matrix(~ - 1 + ., data = dfXY) %>% scale()
dist <- mat %>% dist(method = metric)
dim(mat)
colnames(mat)
hopkins <- get_clust_tendency(mat, n = nrow(mat) - 1, graph = FALSE)
diana <- dist %>% diana(metric = metric)
k <- 2
dianaXY <- hcDIANA(k)
```

* Hopkins statistic is `r sprintf("%.03f", hopkins$hopkins_stat)`
* Analysis identified $k = `r k`$ clusters
* Divisive coefficient is `r sprintf("%.03f", diana$dc)`
* Average silhouette width is `r sprintf("%.03f", dianaXY[["hcut"]][["silinfo"]][["avg.width"]])`

```{r clusterXY}
dianaXY[["dendrogram"]]
dianaXY[["clusters2d"]]
dianaXY[["silhouette"]]
```

```{r}
bind_cols(dfXY, 
          data.frame(cluster = dianaXY[["hcut"]][["cluster"]] %>% factor())) %>%
  group_by(cluster) %>%
  summarize(n = n(),
            ECBI_intensity_T_score_mean = mean(ECBI_intensity_T_score),
            ECBI_problem_T_score_mean   = mean(ECBI_problem_T_score),
            ECBI_Opp_mean               = mean(ECBI_Opp),
            ECBI_Inatt_mean             = mean(ECBI_Inatt),
            ECBI_Cond_mean              = mean(ECBI_Cond)) %>%
  kable(digits = 1)
bind_cols(dfXY, 
          data.frame(cluster = dianaXY[["hcut"]][["cluster"]] %>% factor())) %>%
  group_by(cluster) %>%
  summarize(n = n(),
            MAPS_PP_mean  = mean(MAPS_PP),
            MAPS_PR_mean  = mean(MAPS_PR),
            MAPS_WM_mean  = mean(MAPS_WM),
            MAPS_SP_mean  = mean(MAPS_SP),
            MAPS_HS_mean  = mean(MAPS_HS),
            MAPS_LC_mean  = mean(MAPS_LC),
            MAPS_PC_mean  = mean(MAPS_PC),
            MAPS_POS_mean = mean(MAPS_POS),
            MAPS_NEG_mean = mean(MAPS_NEG)) %>%
  kable(digits = 1)
bind_cols(dfXY, 
          data.frame(cluster = dianaXY[["hcut"]][["cluster"]] %>% factor())) %>%
  group_by(cluster) %>%
  summarize(n = n(),
            SEPTI_nurturance_mean = mean(SEPTI_nurturance),
            SEPTI_discipline_mean = mean(SEPTI_discipline),
            SEPTI_play_mean       = mean(SEPTI_play),
            SEPTI_routine_mean    = mean(SEPTI_routine)) %>%
  kable(digits = 1)
```

```{r}
bind_cols(dfXY, 
          data.frame(cluster = dianaXY[["hcut"]][["cluster"]] %>% factor())) %>%
  group_by(cluster, parentRaceWhite) %>%
  summarize(n = n()) %>% 
  mutate(pct = n / sum(n)) %>% 
  kable(digits = 2)
```

```{r}
bind_cols(dfXY, 
          data.frame(cluster = dianaXY[["hcut"]][["cluster"]] %>% factor())) %>%
  group_by(cluster) %>%
  summarize(n = n(),
            PCB1_Total_mean      = mean(PCB1_Total),
            PCB1_CondEmot_mean   = mean(PCB1_CondEmot),
            PCB1_DevHab_mean     = mean(PCB1_DevHab)) %>% 
  kable(digits = 1)
bind_cols(dfXY, 
          data.frame(cluster = dianaXY[["hcut"]][["cluster"]] %>% factor())) %>%
  group_by(cluster) %>%
  summarize(n = n(),
            PCB2_Tot_mean        = mean(PCB2_Tot)) %>% 
  kable(digits = 1)
bind_cols(dfXY, 
          data.frame(cluster = dianaXY[["hcut"]][["cluster"]] %>% factor())) %>%
  group_by(cluster) %>%
  summarize(n = n(),
            PCB3_Total_mean      = mean(PCB3_Total),
            PCB3_PCPonly_mean    = mean(PCB3_PCPonly),
            PCB3_Person_mean     = mean(PCB3_Person),
            PCB3_Resource_mean   = mean(PCB3_Resource)) %>% 
  kable(digits = 1)
```


## Save objects

```{r}
f <- "data/processed/clusterAnalysis.RData"
save(dianaYPCB, dianaXECBI, dianaXMAPS, dianaXSEPTI, dianaXMetricsDemog, dianaXY, file = f)
file.info(f)
```
